<!DOCTYPE html>
<html lang="ur" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0b1a0f">
<meta name="description" content="Hamara Ghar â€” Private Family Cloud">
<meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
<title>Hamara Ghar ğŸ¡</title>
<link rel="manifest" href="manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#060e08;--bg2:#0b1a0f;--surface:#0f2214;--surface2:#152b1a;--surface3:#1a3320;
  --border:rgba(212,175,55,0.15);--border2:rgba(212,175,55,0.3);
  --gold:#d4af37;--gold-lt:#f0d060;--gold-dk:#a8860a;
  --emerald:#2ecc71;--emerald-dk:#1a8a4a;
  --text:#f5ede0;--text-muted:#8a9e8d;--red:#e05555;
  --radius:14px;--shadow:0 12px 48px rgba(0,0,0,0.6);
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background:radial-gradient(ellipse 70% 50% at 15% 20%,rgba(46,204,113,0.07) 0%,transparent 60%),
  radial-gradient(ellipse 60% 70% at 85% 75%,rgba(212,175,55,0.06) 0%,transparent 60%);}
body::after{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:repeating-linear-gradient(45deg,rgba(212,175,55,0.02) 0px,rgba(212,175,55,0.02) 1px,transparent 1px,transparent 40px),
  repeating-linear-gradient(-45deg,rgba(212,175,55,0.02) 0px,rgba(212,175,55,0.02) 1px,transparent 1px,transparent 40px);}
.view{display:none;position:relative;z-index:1;}
.view.active{display:flex;}

/* â”€â”€ MEMBER SELECT â”€â”€ */
#memberView{min-height:100vh;align-items:center;justify-content:center;flex-direction:column;padding:24px;}
.welcome-header{text-align:center;margin-bottom:48px;animation:fadeDown 0.8s cubic-bezier(0.16,1,0.3,1) both;}
@keyframes fadeDown{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
.brand-emblem{width:100px;height:100px;border-radius:50%;border:2px solid var(--gold);display:flex;align-items:center;justify-content:center;font-size:44px;margin:0 auto 20px;background:radial-gradient(circle,rgba(212,175,55,0.1) 0%,transparent 70%);box-shadow:0 0 50px rgba(212,175,55,0.15),inset 0 0 30px rgba(212,175,55,0.05);animation:glowPulse 4s ease-in-out infinite;}
@keyframes glowPulse{0%,100%{box-shadow:0 0 50px rgba(212,175,55,0.15);}50%{box-shadow:0 0 80px rgba(212,175,55,0.3);}}
.brand-title{font-family:'Cormorant Garamond',serif;font-size:40px;font-weight:700;color:var(--gold);letter-spacing:3px;text-shadow:0 0 40px rgba(212,175,55,0.3);}
.brand-urdu{font-size:22px;color:rgba(212,175,55,0.7);margin-top:4px;letter-spacing:2px;}
.brand-sub{font-size:11px;color:var(--text-muted);letter-spacing:3px;text-transform:uppercase;margin-top:8px;}
.divider-line{display:flex;align-items:center;gap:12px;margin:14px auto 0;width:fit-content;}
.divider-line::before,.divider-line::after{content:'';width:50px;height:1px;background:linear-gradient(90deg,transparent,var(--gold));}
.divider-line::after{background:linear-gradient(90deg,var(--gold),transparent);}
.divider-line span{color:var(--gold);font-size:14px;}
.member-prompt{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:2.5px;color:var(--text-muted);text-align:center;margin-bottom:22px;animation:fadeDown 0.8s 0.2s both;}
.members-select-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;width:100%;max-width:380px;animation:fadeDown 0.8s 0.3s both;}
.member-select-card{background:linear-gradient(145deg,var(--surface),var(--surface2));border:1px solid var(--border);border-radius:18px;padding:26px 16px;cursor:pointer;transition:all 0.3s cubic-bezier(0.16,1,0.3,1);text-align:center;position:relative;overflow:hidden;}
.member-select-card::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(212,175,55,0.05),rgba(46,204,113,0.05));opacity:0;transition:opacity 0.3s;}
.member-select-card:hover{border-color:var(--border2);transform:translateY(-5px);box-shadow:0 20px 50px rgba(0,0,0,0.5),0 0 25px rgba(212,175,55,0.1);}
.member-select-card:hover::after{opacity:1;}
.member-select-card:active{transform:scale(0.96);}
.msc-wrap{width:68px;height:68px;border-radius:50%;margin:0 auto 14px;display:flex;align-items:center;justify-content:center;font-size:32px;position:relative;}
.msc-ring{position:absolute;inset:-3px;border-radius:50%;border:1.5px solid rgba(212,175,55,0.5);}
.msc-name{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:600;color:var(--gold-lt);margin-bottom:2px;}
.msc-urdu{font-size:14px;color:rgba(212,175,55,0.5);margin-bottom:2px;}
.msc-role{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;}
.bismillah{text-align:center;margin-top:36px;font-size:12px;color:rgba(212,175,55,0.25);letter-spacing:3px;animation:fadeDown 0.8s 0.6s both;}

/* â”€â”€ PASSWORD â”€â”€ */
#passwordView{min-height:100vh;align-items:center;justify-content:center;flex-direction:column;padding:24px;}
.pw-card{background:linear-gradient(145deg,var(--surface),var(--surface2));border:1px solid var(--border);border-radius:24px;padding:44px 36px;width:100%;max-width:400px;box-shadow:var(--shadow),0 0 60px rgba(212,175,55,0.05);animation:slideUp 0.5s cubic-bezier(0.16,1,0.3,1);}
@keyframes slideUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
.pw-back{display:flex;align-items:center;gap:8px;background:none;border:1px solid var(--border);border-radius:10px;padding:9px 16px;color:var(--text-muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;cursor:pointer;transition:all 0.2s;margin-bottom:28px;}
.pw-back:hover{border-color:var(--border2);color:var(--gold);}
.pw-user{text-align:center;margin-bottom:30px;}
.pw-avatar{width:82px;height:82px;border-radius:50%;margin:0 auto 14px;display:flex;align-items:center;justify-content:center;font-size:38px;background:linear-gradient(135deg,var(--surface3),var(--surface2));border:2px solid var(--border2);box-shadow:0 0 30px rgba(212,175,55,0.12);}
.pw-name{font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:700;color:var(--gold);}
.pw-greet{font-size:13px;color:var(--text-muted);margin-top:4px;}
.pw-dots{display:flex;gap:9px;justify-content:center;margin-bottom:22px;}
.pw-dot{width:11px;height:11px;border-radius:50%;border:1.5px solid var(--border2);background:transparent;transition:all 0.2s;}
.pw-dot.filled{background:var(--gold);border-color:var(--gold);box-shadow:0 0 8px rgba(212,175,55,0.5);}
.pw-label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:2px;color:var(--text-muted);display:block;margin-bottom:8px;}
.pw-wrap{position:relative;margin-bottom:20px;}
.pw-inp{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:15px 48px 15px 16px;color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;outline:none;transition:border-color 0.2s,box-shadow 0.2s;letter-spacing:4px;}
.pw-inp:focus{border-color:var(--border2);box-shadow:0 0 0 3px rgba(212,175,55,0.08);}
.pw-eye{position:absolute;right:14px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:18px;transition:color 0.2s;}
.pw-eye:hover{color:var(--gold);}
.btn-enter{width:100%;background:linear-gradient(135deg,var(--gold-dk),var(--gold));border:none;border-radius:12px;padding:16px;color:#060e08;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:all 0.2s;letter-spacing:0.5px;position:relative;overflow:hidden;}
.btn-enter:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(212,175,55,0.35);}
.btn-enter:active{transform:scale(0.98);}
.pw-err{text-align:center;font-size:13px;color:var(--red);margin-top:12px;display:none;}
.pw-att{text-align:center;font-size:11px;color:var(--text-muted);margin-top:8px;display:none;}
@keyframes shake{0%,100%{transform:translateX(0);}20%,60%{transform:translateX(-7px);}40%,80%{transform:translateX(7px);}}
.shake{animation:shake 0.4s !important;}

/* â”€â”€ LOCKOUT â”€â”€ */
#lockoutView{min-height:100vh;align-items:center;justify-content:center;flex-direction:column;padding:24px;text-align:center;gap:16px;}
.lo-icon{font-size:72px;}.lo-title{font-family:'Cormorant Garamond',serif;font-size:30px;color:var(--red);}
.lo-msg{font-size:14px;color:var(--text-muted);max-width:300px;line-height:1.6;}
.lo-timer{font-size:40px;font-weight:700;color:var(--gold);font-family:'Cormorant Garamond',serif;}

/* â”€â”€ APP â”€â”€ */
#appView{flex-direction:column;min-height:100vh;}
.app-header{position:sticky;top:0;z-index:100;background:rgba(6,14,8,0.93);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 20px;height:62px;display:flex;align-items:center;justify-content:space-between;}
.header-brand{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:var(--gold);letter-spacing:1px;}
.header-right{display:flex;align-items:center;gap:10px;}
.user-chip{display:flex;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:6px 14px 6px 10px;font-size:13px;}
.u-dot{width:7px;height:7px;border-radius:50%;background:var(--emerald);box-shadow:0 0 6px var(--emerald);}
.icon-btn{background:var(--surface);border:1px solid var(--border);border-radius:10px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;color:var(--text);transition:all 0.2s;}
.icon-btn:hover{border-color:var(--border2);color:var(--gold);}
.app-tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border);padding:0 20px;overflow-x:auto;-webkit-overflow-scrolling:touch;}
.app-tabs::-webkit-scrollbar{display:none;}
.tab-btn{background:none;border:none;color:var(--text-muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:500;padding:13px 15px;cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;white-space:nowrap;display:flex;align-items:center;gap:5px;}
.tab-btn.active{color:var(--gold);border-bottom-color:var(--gold);}
.tab-btn:hover:not(.active){color:var(--text);}
.app-content{flex:1;padding:24px;max-width:1100px;margin:0 auto;width:100%;}
.sec-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;}
.sec-title{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:700;color:var(--gold-lt);}
.sec-title small{display:block;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:400;color:var(--text-muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:2px;}
.back-btn{display:inline-flex;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:9px 16px;color:var(--text-muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;cursor:pointer;transition:all 0.2s;margin-bottom:20px;}
.back-btn:hover{border-color:var(--border2);color:var(--gold);}
.upload-zone{border:1.5px dashed rgba(212,175,55,0.22);border-radius:var(--radius);padding:36px;text-align:center;cursor:pointer;transition:all 0.3s;margin-bottom:26px;background:rgba(212,175,55,0.02);position:relative;}
.upload-zone:hover,.upload-zone.drag-over{border-color:var(--gold);background:rgba(212,175,55,0.05);}
.upload-zone input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.upload-icon{font-size:36px;margin-bottom:10px;color:var(--gold);}
.upload-zone h3{font-size:15px;font-weight:600;margin-bottom:4px;}
.upload-zone p{color:var(--text-muted);font-size:12px;}
.albums-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:16px;}
.album-card{background:linear-gradient(145deg,var(--surface),var(--surface2));border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;cursor:pointer;transition:all 0.3s;}
.album-card:hover{transform:translateY(-5px);box-shadow:0 16px 40px rgba(0,0,0,0.5),0 0 20px rgba(212,175,55,0.07);border-color:var(--border2);}
.album-thumb{height:148px;display:flex;align-items:center;justify-content:center;font-size:50px;position:relative;overflow:hidden;background:var(--surface3);}
.album-thumb img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0;}
.album-grd{position:absolute;bottom:0;left:0;right:0;height:50%;background:linear-gradient(transparent,rgba(0,0,0,0.6));}
.album-info{padding:14px;}
.album-name{font-weight:600;font-size:14px;margin-bottom:4px;}
.album-meta{font-size:11px;color:var(--text-muted);display:flex;justify-content:space-between;}
.photos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;}
.photo-item{aspect-ratio:1;background:var(--surface2);border-radius:12px;overflow:hidden;cursor:pointer;transition:all 0.2s;position:relative;border:1px solid var(--border);}
.photo-item:hover{transform:scale(1.04);box-shadow:0 8px 24px rgba(0,0,0,0.5);border-color:var(--border2);}
.photo-item img{width:100%;height:100%;object-fit:cover;display:block;}
.photo-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;gap:10px;opacity:0;transition:opacity 0.2s;}
.photo-item:hover .photo-overlay{opacity:1;}
.ph-act{background:rgba(255,255,255,0.1);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.2);border-radius:8px;width:38px;height:38px;color:white;font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background 0.2s;}
.ph-act:hover{background:rgba(255,255,255,0.25);}
.ph-label{position:absolute;bottom:6px;left:6px;font-size:10px;background:rgba(0,0,0,0.75);padding:2px 7px;border-radius:4px;opacity:0;transition:opacity 0.2s;}
.photo-item:hover .ph-label{opacity:1;}
.lightbox{position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,0.97);display:none;align-items:center;justify-content:center;animation:fadeIn 0.2s;}
.lightbox.open{display:flex;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
.lb-img{max-width:90vw;max-height:85vh;border-radius:10px;object-fit:contain;box-shadow:0 0 80px rgba(0,0,0,0.9);}
.lb-close{position:fixed;top:18px;right:18px;background:rgba(255,255,255,0.08);border:none;border-radius:50%;width:44px;height:44px;color:white;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background 0.2s;}
.lb-close:hover{background:rgba(255,255,255,0.18);}
.lb-nav{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);display:flex;gap:10px;}
.lb-btn{background:rgba(255,255,255,0.08);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.15);border-radius:12px;padding:10px 18px;color:white;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:500;display:flex;align-items:center;gap:6px;transition:all 0.2s;}
.lb-btn:hover{background:rgba(255,255,255,0.16);}
.lb-dl{background:linear-gradient(135deg,var(--gold-dk),var(--gold));border-color:transparent;color:#060e08;font-weight:700;}
.lb-dl:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(212,175,55,0.4);}
.memory-timeline{display:flex;flex-direction:column;gap:16px;}
.memory-card{background:linear-gradient(145deg,var(--surface),var(--surface2));border:1px solid var(--border);border-radius:var(--radius);padding:20px;display:flex;gap:16px;transition:border-color 0.2s;}
.memory-card:hover{border-color:var(--border2);}
.mem-date{flex-shrink:0;text-align:center;width:50px;}
.mem-day{font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:700;color:var(--gold);line-height:1;}
.mem-month{font-size:10px;text-transform:uppercase;color:var(--text-muted);letter-spacing:1px;}
.mem-body{flex:1;}
.mem-title{font-size:15px;font-weight:600;margin-bottom:4px;}
.mem-desc{font-size:13px;color:var(--text-muted);line-height:1.6;}
.members-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;}
.member-card{background:linear-gradient(145deg,var(--surface),var(--surface2));border:1px solid var(--border);border-radius:var(--radius);padding:28px 20px;text-align:center;transition:all 0.3s;}
.member-card:hover{border-color:var(--border2);transform:translateY(-4px);box-shadow:0 12px 30px rgba(0,0,0,0.4);}
.mc-avatar{font-size:48px;margin-bottom:12px;display:block;}
.mc-name{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:600;color:var(--gold-lt);margin-bottom:2px;}
.mc-urdu{font-size:16px;color:rgba(212,175,55,0.5);margin-bottom:4px;}
.mc-role{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;}
.mc-cnt{margin-top:10px;font-size:12px;color:var(--emerald);}
.settings-card{background:linear-gradient(145deg,var(--surface),var(--surface2));border:1px solid var(--border);border-radius:var(--radius);padding:22px;margin-bottom:14px;}
.settings-card h3{font-size:15px;font-weight:600;margin-bottom:12px;color:var(--gold-lt);}
.modal-overlay{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;padding:24px;}
.modal-overlay.open{display:flex;}
.modal-box{background:linear-gradient(145deg,var(--surface),var(--surface2));border:1px solid var(--border);border-radius:20px;padding:32px;width:100%;max-width:420px;box-shadow:var(--shadow);animation:slideUp 0.3s cubic-bezier(0.16,1,0.3,1);}
.modal-title{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:var(--gold);margin-bottom:22px;}
.inp-group{margin-bottom:15px;}
.inp-group label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-muted);display:block;margin-bottom:7px;}
.inp-group input{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:13px 15px;color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;outline:none;transition:border-color 0.2s,box-shadow 0.2s;}
.inp-group input:focus{border-color:var(--border2);box-shadow:0 0 0 3px rgba(212,175,55,0.08);}
.btn-gold{background:linear-gradient(135deg,var(--gold-dk),var(--gold));border:none;border-radius:10px;padding:12px 20px;color:#060e08;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.2s;}
.btn-gold:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(212,175,55,0.35);}
.btn-ghost{background:transparent;border:1px solid var(--border);border-radius:10px;padding:12px 20px;color:var(--text-muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;cursor:pointer;transition:all 0.2s;}
.btn-ghost:hover{border-color:var(--border2);color:var(--text);}
.badge{display:inline-flex;align-items:center;gap:4px;background:rgba(46,204,113,0.12);border:1px solid rgba(46,204,113,0.3);color:var(--emerald);padding:4px 10px;border-radius:20px;font-size:11px;font-weight:500;}
.storage-bar{background:var(--bg);border-radius:4px;height:5px;overflow:hidden;margin-top:8px;}
.storage-fill{height:100%;background:linear-gradient(90deg,var(--emerald-dk),var(--gold));border-radius:4px;width:5%;transition:width 0.5s;}
.storage-info{display:flex;justify-content:space-between;font-size:11px;color:var(--text-muted);margin-top:6px;}
.empty-state{text-align:center;padding:50px 20px;color:var(--text-muted);grid-column:1/-1;}
.empty-state .es-icon{font-size:48px;margin-bottom:14px;}
.empty-state h3{font-size:17px;color:var(--text);margin-bottom:6px;}
.empty-state p{font-size:13px;line-height:1.6;}
.toast{position:fixed;bottom:24px;right:24px;background:var(--surface);border:1px solid var(--border2);border-radius:12px;padding:14px 20px;font-size:13px;z-index:999;box-shadow:var(--shadow);transform:translateY(80px);opacity:0;transition:all 0.35s cubic-bezier(0.16,1,0.3,1);max-width:280px;}
.toast.show{transform:translateY(0);opacity:1;}
.offline-badge{position:fixed;top:14px;right:14px;background:linear-gradient(135deg,#c0392b,#e74c3c);color:white;padding:6px 14px;border-radius:20px;font-size:11px;font-weight:700;display:none;z-index:999;}
.tab-panel{display:none;}
.tab-panel.active{display:block;}
::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:3px;}
@media(max-width:480px){.members-select-grid{grid-template-columns:repeat(2,1fr);}.albums-grid{grid-template-columns:repeat(2,1fr);}.photos-grid{grid-template-columns:repeat(2,1fr);}.app-content{padding:16px;}.brand-title{font-size:32px;}.pw-card{padding:32px 20px;}}
</style>
</head>
<body>
<div class="offline-badge" id="offlineBadge">ğŸ“¡ Offline</div>
<div class="toast" id="toast"></div>

<!-- â•â• STEP 1: MEMBER SELECT â•â• -->
<div class="view active" id="memberView">
  <div style="width:100%;display:flex;flex-direction:column;align-items:center;padding:40px 24px 60px;">
    <div class="welcome-header">
      <div class="brand-emblem">ğŸ¡</div>
      <div class="brand-title">Hamara Ghar</div>
      <div class="brand-urdu">ÛÙ…Ø§Ø±Ø§ Ú¯Ú¾Ø±</div>
      <div class="brand-sub">Private Family Cloud</div>
      <div class="divider-line"><span>âœ¦</span></div>
    </div>

    <div class="member-prompt">Apna naam chunein â€” Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… Ú†Ù†ÛŒÚº</div>

    <div class="members-select-grid">
      <div class="member-select-card" onclick="selectMemberStep('kausar')">
        <div class="msc-wrap" style="background:linear-gradient(135deg,#1a3a2a,#0f2214);">
          <div class="msc-ring"></div>ğŸŒ¸
        </div>
        <div class="msc-name">Kausar</div>
        <div class="msc-urdu">Ú©ÙˆØ«Ø±</div>
        <div class="msc-role">Family Member</div>
      </div>
      <div class="member-select-card" onclick="selectMemberStep('naziya')">
        <div class="msc-wrap" style="background:linear-gradient(135deg,#2a1a3a,#1a0f2e);">
          <div class="msc-ring"></div>ğŸŒ¹
        </div>
        <div class="msc-name">Naziya</div>
        <div class="msc-urdu">Ù†Ø§Ø²ÛŒÛ</div>
        <div class="msc-role">Family Member</div>
      </div>
      <div class="member-select-card" onclick="selectMemberStep('nilofar')">
        <div class="msc-wrap" style="background:linear-gradient(135deg,#1a2a3a,#0f1a2e);">
          <div class="msc-ring"></div>ğŸŒº
        </div>
        <div class="msc-name">Nilofar</div>
        <div class="msc-urdu">Ù†ÛŒÙ„ÙˆÙØ±</div>
        <div class="msc-role">Family Member</div>
      </div>
      <div class="member-select-card" onclick="selectMemberStep('vaseem')">
        <div class="msc-wrap" style="background:linear-gradient(135deg,#2a2a1a,#1a1a0f);">
          <div class="msc-ring"></div>ğŸŒ¿
        </div>
        <div class="msc-name">Vaseem</div>
        <div class="msc-urdu">ÙˆØ³ÛŒÙ…</div>
        <div class="msc-role">Family Member</div>
      </div>
    </div>
    <div class="bismillah">âœ¦ ï·½ âœ¦ â€” Sirf Hamare Ghar Ke Liye</div>
  </div>
</div>

<!-- â•â• STEP 2: PASSWORD â•â• -->
<div class="view" id="passwordView">
  <div style="width:100%;display:flex;align-items:center;justify-content:center;padding:24px;min-height:100vh;">
    <div class="pw-card" id="pwCard">
      <button class="pw-back" onclick="goBackToMembers()">â† Wapas Jao</button>
      <div class="pw-user">
        <div class="pw-avatar"><span id="pwEmoji">ğŸŒ¸</span></div>
        <div class="pw-name" id="pwName">Kausar</div>
        <div class="pw-greet">Assalamu Alaikum ğŸ¤² Password enter karein</div>
      </div>
      <div class="pw-dots">
        <div class="pw-dot" id="d0"></div><div class="pw-dot" id="d1"></div>
        <div class="pw-dot" id="d2"></div><div class="pw-dot" id="d3"></div>
        <div class="pw-dot" id="d4"></div><div class="pw-dot" id="d5"></div>
        <div class="pw-dot" id="d6"></div><div class="pw-dot" id="d7"></div>
      </div>
      <span class="pw-label">Family Password</span>
      <div class="pw-wrap">
        <input class="pw-inp" type="password" id="pwInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          oninput="updateDots()" onkeydown="if(event.key==='Enter')doLogin()">
        <button class="pw-eye" id="pwEyeBtn" onclick="togglePwVis()">ğŸ‘ï¸</button>
      </div>
      <button class="btn-enter" onclick="doLogin()">âœ¦ Ghar Mein Pravesh Karein</button>
      <p class="pw-err" id="pwErr">âŒ Galat password! Dobara koshish karein.</p>
      <p class="pw-att" id="pwAtt"></p>
    </div>
  </div>
</div>

<!-- â•â• LOCKOUT â•â• -->
<div class="view" id="lockoutView">
  <div class="lo-icon">ğŸ”’</div>
  <div class="lo-title">Account Temporarily Locked</div>
  <div class="lo-msg">Zyada baar galat password dala gaya. Kuch der baad dobara koshish karein.</div>
  <div class="lo-timer" id="loTimer">05:00</div>
  <button class="btn-ghost" onclick="tryUnlock()" style="margin-top:8px;">ğŸ”„ Check Again</button>
</div>

<!-- â•â• MAIN APP â•â• -->
<div class="view" id="appView">
  <header class="app-header">
    <div class="header-brand">ğŸ¡ Hamara Ghar</div>
    <div class="header-right">
      <div class="user-chip"><div class="u-dot"></div><span id="userChipTxt">â€”</span></div>
      <button class="icon-btn" onclick="doLogout()" title="Logout">ğŸšª</button>
    </div>
  </header>
  <nav class="app-tabs">
    <button class="tab-btn active" onclick="switchTab('albums',this)">ğŸ–¼ï¸ Albums</button>
    <button class="tab-btn" onclick="switchTab('photos',this)">ğŸ“· Photos</button>
    <button class="tab-btn" onclick="switchTab('memories',this)">ğŸ’ Yaadein</button>
    <button class="tab-btn" onclick="switchTab('members',this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family</button>
    <button class="tab-btn" onclick="switchTab('settings',this)">âš™ï¸ Settings</button>
  </nav>
  <div class="app-content">

    <!-- ALBUMS -->
    <div class="tab-panel active" id="tab-albums">
      <div id="albumListView">
        <div class="sec-header">
          <div class="sec-title"><small>Photo Albums</small>Hamari Gallery</div>
          <button class="btn-gold" onclick="openModal('addAlbumModal')">+ New Album</button>
        </div>
        <div class="upload-zone" id="mainUploadZone">
          <input type="file" multiple accept="image/*,video/*" id="mainFileInput" onchange="handleFiles(this.files)">
          <div class="upload-icon">âœ¦</div>
          <h3>Photos Yahan Drop Karein</h3>
          <p>Ya click karein â€” JPG, PNG, MP4 supported</p>
        </div>
        <div class="albums-grid" id="albumsGrid"></div>
      </div>
      <div id="albumDetailView" style="display:none;">
        <button class="back-btn" onclick="showAlbumList()">â† Albums Par Wapas</button>
        <div class="sec-header">
          <div class="sec-title" id="albDetailTitle"><small>Album</small></div>
          <button class="btn-gold" id="dlAlbumBtn">â¬‡ Download All</button>
        </div>
        <div class="photos-grid" id="albumPhotosGrid"></div>
      </div>
    </div>

    <!-- PHOTOS -->
    <div class="tab-panel" id="tab-photos">
      <div class="sec-header">
        <div class="sec-title"><small>All Photos</small>Saari Tasveeren</div>
        <div style="display:flex;gap:8px;">
          <button class="btn-ghost" onclick="sortPhotos()">â‡… Sort</button>
          <button class="btn-gold" onclick="document.getElementById('pTabInp').click()">+ Add</button>
          <input type="file" id="pTabInp" multiple accept="image/*,video/*" style="display:none" onchange="handleFiles(this.files)">
        </div>
      </div>
      <div class="photos-grid" id="allPhotosGrid"></div>
    </div>

    <!-- MEMORIES -->
    <div class="tab-panel" id="tab-memories">
      <div class="sec-header">
        <div class="sec-title"><small>Yaadein</small>Khaas Lamhe</div>
        <button class="btn-gold" onclick="openAddMemory()">+ Add Memory</button>
      </div>
      <div class="memory-timeline" id="memoryTimeline"></div>
    </div>

    <!-- MEMBERS -->
    <div class="tab-panel" id="tab-members">
      <div class="sec-header">
        <div class="sec-title"><small>Hamara Parivaar</small>Family Members</div>
      </div>
      <div class="members-grid" id="membersGrid"></div>
    </div>

    <!-- SETTINGS -->
    <div class="tab-panel" id="tab-settings">
      <div class="sec-title" style="margin-bottom:20px;"><small>Settings</small>App Customize Karein</div>
      <div class="settings-card">
        <h3>ğŸ’¾ Storage Usage</h3>
        <div class="storage-bar"><div class="storage-fill" id="storageBar"></div></div>
        <div class="storage-info"><span id="storageUsed">0 MB used</span><span>Local Browser Storage</span></div>
      </div>
      <div class="settings-card">
        <h3>ğŸ”‘ Password Change Karein</h3>
        <div class="inp-group" style="max-width:300px;">
          <label>Naya Password (min 6 characters)</label>
          <input type="password" id="newPwInp" placeholder="Naya password...">
        </div>
        <div class="inp-group" style="max-width:300px;">
          <label>Confirm Password</label>
          <input type="password" id="confirmPwInp" placeholder="Dobara daalen...">
        </div>
        <button class="btn-gold" onclick="changePassword()">ğŸ’¾ Save Password</button>
      </div>
      <div class="settings-card">
        <h3>ğŸ“± PWA â€” Offline Mode</h3>
        <p style="font-size:13px;color:var(--text-muted);margin-bottom:12px;">App internet ke bina bhi chalti hai. Phone home screen par install karein.</p>
        <div class="badge">âœ… Offline Ready (PWA)</div>
      </div>
      <div class="settings-card" style="border-color:rgba(224,85,85,0.25);">
        <h3 style="color:var(--red);">âš ï¸ Danger Zone</h3>
        <p style="font-size:13px;color:var(--text-muted);margin-bottom:14px;">Sab photos aur data hamesha ke liye delete ho jayega!</p>
        <button class="btn-ghost" style="border-color:rgba(224,85,85,0.4);color:var(--red);" onclick="clearAll()">ğŸ—‘ï¸ Sab Kuch Delete</button>
      </div>
    </div>

  </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="lbBgClick(event)">
  <img class="lb-img" id="lbImg" src="" alt="">
  <button class="lb-close" onclick="closeLightbox()">âœ•</button>
  <div class="lb-nav">
    <button class="lb-btn" onclick="prevPhoto()">â† Pehli</button>
    <button class="lb-btn lb-dl" onclick="downloadCurrent()">â¬‡ Download</button>
    <button class="lb-btn" onclick="nextPhoto()">Agli â†’</button>
  </div>
</div>

<!-- ADD ALBUM MODAL -->
<div class="modal-overlay" id="addAlbumModal">
  <div class="modal-box">
    <div class="modal-title">ğŸ“ Naya Album Banayein</div>
    <div class="inp-group"><label>Album Ka Naam</label>
      <input type="text" id="albNameInp" placeholder="Jaise: Eid 2024, Kashmir Trip..."></div>
    <div class="inp-group"><label>Emoji / Icon</label>
      <input type="text" id="albEmojiInp" value="ğŸ“¸" placeholder="ğŸ“¸ ğŸ•Œ ğŸ‚ ğŸŒ¸"></div>
    <div style="display:flex;gap:10px;margin-top:4px;">
      <button class="btn-gold" style="flex:1;" onclick="createAlbum()">âœ¦ Create</button>
      <button class="btn-ghost" onclick="closeModal('addAlbumModal')">Raho</button>
    </div>
  </div>
</div>

<!-- ADD MEMORY MODAL -->
<div class="modal-overlay" id="addMemoryModal">
  <div class="modal-box">
    <div class="modal-title">ğŸ’ Yaad Likhein</div>
    <div class="inp-group"><label>Title</label>
      <input type="text" id="memTitleInp" placeholder="Khaas lamhe ka naam..."></div>
    <div class="inp-group"><label>Tarikh</label>
      <input type="date" id="memDateInp"></div>
    <div class="inp-group"><label>Description</label>
      <input type="text" id="memDescInp" placeholder="Is waqt ki yaad..."></div>
    <div style="display:flex;gap:10px;margin-top:4px;">
      <button class="btn-gold" style="flex:1;" onclick="saveMemory()">ğŸ’¾ Save</button>
      <button class="btn-ghost" onclick="closeModal('addMemoryModal')">Cancel</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FAMILY CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FAMILY = {
  kausar:  {name:'Kausar', emoji:'ğŸŒ¸', role:'Ghar Ki Roshni',   urdu:'Ú©ÙˆØ«Ø±'},
  naziya:  {name:'Naziya', emoji:'ğŸŒ¹', role:'Pyaar Ki Pratik',  urdu:'Ù†Ø§Ø²ÛŒÛ'},
  nilofar: {name:'Nilofar',emoji:'ğŸŒº', role:'Phoolon Ki Rani',  urdu:'Ù†ÛŒÙ„ÙˆÙØ±'},
  vaseem:  {name:'Vaseem', emoji:'ğŸŒ¿', role:'Ghar Ka Sitaara',  urdu:'ÙˆØ³ÛŒÙ…'},
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SECURITY CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PASS_KEY    = 'hg_pw';
const DATA_KEY    = 'hg_data';
const SESS_KEY    = 'hg_sess';
const ATT_KEY     = 'hg_att';
const LOCK_KEY    = 'hg_lock';
const MAX_ATT     = 5;
const LOCK_MS     = 5 * 60 * 1000;
const DEFAULT_PW  = 'HamaraGhar@786';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser = null, selectedMember = null;
let currentPhotos = [], currentPhotoIndex = 0;
let currentAlbum = null, photosSorted = false;
let lockTimer = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOCKOUT HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const getAtt = () => { try{return parseInt(localStorage.getItem(ATT_KEY)||'0');}catch{return 0;} };
const setAtt = n => { try{localStorage.setItem(ATT_KEY,String(n));}catch{} };
const getLock = () => { try{return parseInt(localStorage.getItem(LOCK_KEY)||'0');}catch{return 0;} };
const setLock = t => { try{localStorage.setItem(LOCK_KEY,String(t));}catch{} };

function isLocked() {
  const t = getLock();
  if (!t) return false;
  if (Date.now() < t) return true;
  setLock(0); setAtt(0); return false;
}

function lockAccount() {
  setLock(Date.now() + LOCK_MS);
  setAtt(0);
  showView('lockoutView');
  startLockTimer();
}

function startLockTimer() {
  if (lockTimer) clearInterval(lockTimer);
  lockTimer = setInterval(() => {
    const rem = Math.max(0, getLock() - Date.now());
    const m = Math.floor(rem/60000), s = Math.floor((rem%60000)/1000);
    document.getElementById('loTimer').textContent = String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
    if (rem <= 0) { clearInterval(lockTimer); setLock(0); setAtt(0); showView('memberView'); }
  }, 500);
}

function tryUnlock() {
  if (!isLocked()) { if(lockTimer) clearInterval(lockTimer); showView('memberView'); }
  else { showToast('â³ Abhi bhi locked hai. Wait karein.'); startLockTimer(); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT â€” session check
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  if (isLocked()) { startLockTimer(); showView('lockoutView'); return; }
  try {
    const s = JSON.parse(sessionStorage.getItem(SESS_KEY));
    if (s && FAMILY[s.m] && Date.now() - s.t < 3600000) { currentUser=s.m; enterApp(); return; }
  } catch {}
  showView('memberView');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOGIN FLOW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selectMemberStep(id) {
  if (isLocked()) { startLockTimer(); showView('lockoutView'); return; }
  selectedMember = id;
  const m = FAMILY[id];
  document.getElementById('pwEmoji').textContent = m.emoji;
  document.getElementById('pwName').textContent = m.name;
  document.getElementById('pwInput').value = '';
  document.getElementById('pwErr').style.display = 'none';
  document.getElementById('pwAtt').style.display = 'none';
  updateDots();
  showView('passwordView');
  setTimeout(() => document.getElementById('pwInput').focus(), 300);
}

function goBackToMembers() {
  selectedMember = null;
  showView('memberView');
}

function updateDots() {
  const len = document.getElementById('pwInput').value.length;
  for (let i=0;i<8;i++) {
    const d = document.getElementById('d'+i);
    if (d) d.classList.toggle('filled', i < len);
  }
}

function togglePwVis() {
  const inp = document.getElementById('pwInput');
  const eye = document.getElementById('pwEyeBtn');
  inp.type = inp.type==='password' ? 'text' : 'password';
  eye.textContent = inp.type==='password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
}

function doLogin() {
  if (isLocked()) { lockAccount(); return; }
  const entered = document.getElementById('pwInput').value;
  const stored  = localStorage.getItem(PASS_KEY) || DEFAULT_PW;
  if (entered && entered === stored && selectedMember) {
    setAtt(0);
    currentUser = selectedMember;
    try { sessionStorage.setItem(SESS_KEY, JSON.stringify({m:currentUser,t:Date.now()})); } catch{}
    enterApp();
  } else {
    const att = getAtt() + 1;
    setAtt(att);
    const rem = MAX_ATT - att;
    document.getElementById('pwInput').value = '';
    updateDots();
    document.getElementById('pwErr').style.display = 'block';
    // Shake card
    const card = document.getElementById('pwCard');
    card.classList.remove('shake');
    void card.offsetWidth;
    card.classList.add('shake');
    setTimeout(() => card.classList.remove('shake'), 500);
    if (rem <= 0) { lockAccount(); return; }
    if (rem <= 3) {
      document.getElementById('pwAtt').style.display = 'block';
      document.getElementById('pwAtt').textContent = 'âš ï¸ '+rem+' baar aur galat hua to account lock ho jayega!';
    }
  }
}

function enterApp() {
  const m = FAMILY[currentUser];
  document.getElementById('userChipTxt').textContent = m.emoji + ' ' + m.name;
  showView('appView');
  renderAll();
  updateStorageInfo();
}

function doLogout() {
  try { sessionStorage.removeItem(SESS_KEY); } catch{}
  currentUser = null; selectedMember = null;
  showView('memberView');
  showToast('ğŸ‘‹ Logout ho gaye. Khuda Hafiz!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadData() {
  try { return JSON.parse(localStorage.getItem(DATA_KEY)) || defaultData(); } catch { return defaultData(); }
}
function saveData(d) {
  try { localStorage.setItem(DATA_KEY, JSON.stringify(d)); } catch { showToast('âš ï¸ Storage full! Kuch photos delete karein.'); }
}
function defaultData() {
  return {
    albums:[
      {id:'a1',name:'Eid Ki Khushiyan',emoji:'ğŸ•Œ',photos:[],createdBy:'Family',createdAt:Date.now()-864e5*10},
      {id:'a2',name:'Ghar Ki Yaadein', emoji:'ğŸ¡',photos:[],createdBy:'Family',createdAt:Date.now()-864e5*20},
    ],
    photos:[],
    memories:[
      {id:'m1',title:'ğŸ•Œ Eid Mubarak!',date:'2024-04-10',desc:'Is saal ki Eid bahut achi rahi. Poora ghar saath tha, bahut khushi ka din tha.'},
      {id:'m2',title:'ğŸŒ¸ Pehli Barish',date:'2024-07-15',desc:'Baarish mein saath chai piya â€” har lamha yaadgaar tha.'},
    ]
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FILE UPLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handleFiles(files) {
  if (!files.length) return;
  const data = loadData(); let count = 0, total = files.length;
  Array.from(files).forEach(file => {
    if (file.size > 15*1024*1024) { showToast('âš ï¸ "'+file.name+'" bahut bada! (max 15MB)'); total--; return; }
    const reader = new FileReader();
    reader.onload = e => {
      const p = {id:'p-'+Date.now()+'-'+Math.random().toString(36).slice(2,5),
        name:file.name, src:e.target.result, type:file.type, size:file.size,
        uploadedBy:FAMILY[currentUser]?.name||currentUser, uploadedAt:Date.now(), albumId:currentAlbum||null};
      data.photos.push(p);
      if (currentAlbum) {
        const alb = data.albums.find(a=>a.id===currentAlbum);
        if (alb && !alb.photos.includes(p.id)) alb.photos.push(p.id);
      }
      count++;
      if (count===total) {
        saveData(data); renderAll();
        if (currentAlbum) openAlbum(currentAlbum);
        showToast('âœ… '+count+' photo'+(count>1?'s':'')+' upload ho gaye!');
        updateStorageInfo();
      }
    };
    reader.readAsDataURL(file);
  });
}

const uz = document.getElementById('mainUploadZone');
uz.addEventListener('dragover',e=>{e.preventDefault();uz.classList.add('drag-over');});
uz.addEventListener('dragleave',()=>uz.classList.remove('drag-over'));
uz.addEventListener('drop',e=>{e.preventDefault();uz.classList.remove('drag-over');handleFiles(e.dataTransfer.files);});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ALBUMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAlbums() {
  const data = loadData();
  const grid = document.getElementById('albumsGrid');
  if (!data.albums.length) {
    grid.innerHTML = '<div class="empty-state"><div class="es-icon">ğŸ“‚</div><h3>Koi album nahi</h3><p>New album banayein ya photos upload karein</p></div>'; return;
  }
  grid.innerHTML = data.albums.map(alb => {
    const photos = data.photos.filter(p=>alb.photos.includes(p.id));
    const th = photos[0]?.src||null;
    return `<div class="album-card" onclick="openAlbum('${alb.id}')">
      <div class="album-thumb">${th?`<img src="${th}" alt="${alb.name}" loading="lazy">`:alb.emoji}<div class="album-grd"></div></div>
      <div class="album-info"><div class="album-name">${alb.emoji} ${alb.name}</div>
      <div class="album-meta"><span>${photos.length} photos</span><span>${alb.createdBy}</span></div></div></div>`;
  }).join('');
}

function openAlbum(id) {
  currentAlbum = id;
  const data = loadData();
  const alb = data.albums.find(a=>a.id===id);
  const photos = data.photos.filter(p=>alb.photos.includes(p.id));
  document.getElementById('albumListView').style.display = 'none';
  document.getElementById('albumDetailView').style.display = 'block';
  document.getElementById('albDetailTitle').innerHTML = '<small>Album</small>'+alb.emoji+' '+alb.name;
  document.getElementById('dlAlbumBtn').onclick = ()=>downloadAlbum(id);
  const grid = document.getElementById('albumPhotosGrid');
  if (!photos.length) {
    grid.innerHTML = '<div class="empty-state"><div class="es-icon">ğŸ“·</div><h3>Album khali hai</h3><p>Koi bhi photo upload kar sakte hain</p></div>';
  } else {
    currentPhotos = photos;
    grid.innerHTML = photos.map((p,i)=>`
      <div class="photo-item" onclick="openLightbox(${i})">
        <img src="${p.src}" alt="${p.name}" loading="lazy">
        <div class="photo-overlay">
          <button class="ph-act" onclick="event.stopPropagation();downloadPhoto('${p.id}')">â¬‡</button>
          <button class="ph-act" onclick="event.stopPropagation();deletePhoto('${p.id}')">ğŸ—‘ï¸</button>
        </div>
        <div class="ph-label">${p.uploadedBy}</div></div>`).join('');
  }
}

function showAlbumList() {
  currentAlbum = null;
  document.getElementById('albumListView').style.display = 'block';
  document.getElementById('albumDetailView').style.display = 'none';
  renderAlbums();
}

function createAlbum() {
  const name = document.getElementById('albNameInp').value.trim();
  const emoji = document.getElementById('albEmojiInp').value.trim() || 'ğŸ“¸';
  if (!name) { showToast('âš ï¸ Album ka naam daalo!'); return; }
  const data = loadData();
  data.albums.unshift({id:'a-'+Date.now(),name,emoji,photos:[],createdBy:FAMILY[currentUser]?.name||currentUser,createdAt:Date.now()});
  saveData(data); closeModal('addAlbumModal');
  document.getElementById('albNameInp').value = '';
  renderAlbums(); showToast('ğŸ“ "'+name+'" album ban gaya!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ALL PHOTOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAllPhotos() {
  const data = loadData();
  const grid = document.getElementById('allPhotosGrid');
  let photos = [...data.photos];
  if (photosSorted) photos.sort((a,b)=>a.name.localeCompare(b.name));
  else photos.sort((a,b)=>b.uploadedAt-a.uploadedAt);
  if (!photos.length) {
    grid.innerHTML = '<div class="empty-state"><div class="es-icon">ğŸ–¼ï¸</div><h3>Koi tasveer nahi</h3><p>Albums mein photos add karein</p></div>'; return;
  }
  currentPhotos = photos;
  grid.innerHTML = photos.map((p,i)=>`
    <div class="photo-item" onclick="openLightbox(${i})">
      <img src="${p.src}" alt="${p.name}" loading="lazy">
      <div class="photo-overlay">
        <button class="ph-act" onclick="event.stopPropagation();downloadPhoto('${p.id}')">â¬‡</button>
        <button class="ph-act" onclick="event.stopPropagation();deletePhoto('${p.id}')">ğŸ—‘ï¸</button>
      </div>
      <div class="ph-label">${p.uploadedBy}</div></div>`).join('');
}

function sortPhotos() {
  photosSorted = !photosSorted;
  renderAllPhotos();
  showToast(photosSorted?'ğŸ”¤ Naam se sort':'ğŸ• Date se sort');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LIGHTBOX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openLightbox(i) {
  currentPhotoIndex = i;
  document.getElementById('lbImg').src = currentPhotos[i].src;
  document.getElementById('lightbox').classList.add('open');
}
function closeLightbox() { document.getElementById('lightbox').classList.remove('open'); }
function lbBgClick(e) { if(e.target===document.getElementById('lightbox'))closeLightbox(); }
function prevPhoto() { currentPhotoIndex=(currentPhotoIndex-1+currentPhotos.length)%currentPhotos.length; document.getElementById('lbImg').src=currentPhotos[currentPhotoIndex].src; }
function nextPhoto() { currentPhotoIndex=(currentPhotoIndex+1)%currentPhotos.length; document.getElementById('lbImg').src=currentPhotos[currentPhotoIndex].src; }
function downloadCurrent() { downloadPhoto(currentPhotos[currentPhotoIndex].id); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DOWNLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function downloadPhoto(id) {
  const p = loadData().photos.find(ph=>ph.id===id);
  if (!p) return;
  const a = document.createElement('a'); a.href=p.src; a.download=p.name; a.click();
  showToast('â¬‡ "'+p.name+'" download ho raha hai...');
}
function downloadAlbum(id) {
  const data = loadData();
  const alb = data.albums.find(a=>a.id===id);
  const photos = data.photos.filter(p=>alb.photos.includes(p.id));
  if (!photos.length) { showToast('âŒ Album mein koi photo nahi!'); return; }
  photos.forEach((p,i)=>setTimeout(()=>{const a=document.createElement('a');a.href=p.src;a.download=p.name;a.click();},i*350));
  showToast('â¬‡ '+photos.length+' photos download ho rahe hain...');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DELETE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function deletePhoto(id) {
  if (!confirm('Yeh tasveer delete karni hai?')) return;
  const data = loadData();
  data.photos = data.photos.filter(p=>p.id!==id);
  data.albums.forEach(a=>{a.photos=a.photos.filter(pid=>pid!==id);});
  saveData(data);
  if (currentAlbum) openAlbum(currentAlbum); else renderAllPhotos();
  showToast('ğŸ—‘ï¸ Tasveer delete ho gayi.'); updateStorageInfo();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MEMBERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMembers() {
  const data = loadData();
  document.getElementById('membersGrid').innerHTML = Object.entries(FAMILY).map(([k,m])=>{
    const cnt = data.photos.filter(p=>p.uploadedBy===m.name).length;
    return `<div class="member-card">
      <span class="mc-avatar">${m.emoji}</span>
      <div class="mc-name">${m.name}</div>
      <div class="mc-urdu">${m.urdu}</div>
      <div class="mc-role">${m.role}</div>
      <div class="mc-cnt">ğŸ“· ${cnt} photos</div></div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MEMORIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMemories() {
  const data = loadData();
  const tl = document.getElementById('memoryTimeline');
  if (!data.memories.length) {
    tl.innerHTML = '<div class="empty-state"><div class="es-icon">ğŸ’</div><h3>Koi yaad nahi</h3><p>Khaas lamhe yahan save karein</p></div>'; return;
  }
  tl.innerHTML = data.memories.map(m=>{
    const d = new Date(m.date);
    return `<div class="memory-card">
      <div class="mem-date"><div class="mem-day">${d.getDate()}</div><div class="mem-month">${d.toLocaleString('default',{month:'short'})}</div></div>
      <div class="mem-body"><div class="mem-title">${m.title}</div><div class="mem-desc">${m.desc}</div></div></div>`;
  }).join('');
}
function openAddMemory() {
  document.getElementById('memDateInp').valueAsDate = new Date();
  openModal('addMemoryModal');
}
function saveMemory() {
  const title=document.getElementById('memTitleInp').value.trim();
  const date=document.getElementById('memDateInp').value;
  const desc=document.getElementById('memDescInp').value.trim();
  if (!title||!date) { showToast('âš ï¸ Title aur date zaroori hai!'); return; }
  const data = loadData();
  data.memories.unshift({id:'m-'+Date.now(),title,date,desc});
  saveData(data); closeModal('addMemoryModal');
  document.getElementById('memTitleInp').value='';
  document.getElementById('memDescInp').value='';
  renderMemories(); showToast('ğŸ’ Yaad save ho gayi!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function changePassword() {
  const np = document.getElementById('newPwInp').value;
  const cp = document.getElementById('confirmPwInp').value;
  if (!np||np.length<6) { showToast('âš ï¸ Password kam se kam 6 characters ka hona chahiye!'); return; }
  if (np!==cp) { showToast('âŒ Dono passwords match nahi karte!'); return; }
  localStorage.setItem(PASS_KEY, np);
  document.getElementById('newPwInp').value='';
  document.getElementById('confirmPwInp').value='';
  showToast('ğŸ”‘ Password change ho gaya! Yaad rakhein.');
}
function clearAll() {
  if (!confirm('âš ï¸ SARI PHOTOS AUR DATA DELETE HO JAYEGA! Pakka?')) return;
  if (!confirm('Aakhri mauka â€” Bilkul pakka?')) return;
  localStorage.removeItem(DATA_KEY); renderAll(); updateStorageInfo();
  showToast('ğŸ—‘ï¸ Sab delete ho gaya.');
}
function updateStorageInfo() {
  try {
    let tot=0; for(let k in localStorage)if(localStorage.hasOwnProperty(k))tot+=localStorage[k].length;
    const mb=(tot*2/1024/1024).toFixed(1);
    document.getElementById('storageUsed').textContent=mb+' MB used';
    document.getElementById('storageBar').style.width=Math.min(parseFloat(mb)/50*100,100)+'%';
  } catch{}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(name,btn) {
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  if(name==='albums'){showAlbumList();}
  if(name==='photos')renderAllPhotos();
  if(name==='memories')renderMemories();
  if(name==='members')renderMembers();
  if(name==='settings')updateStorageInfo();
}
function renderAll() { renderAlbums(); renderMembers(); renderMemories(); }
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3200);}

// Keyboard
document.addEventListener('keydown', e=>{
  if(e.key==='Escape'){closeLightbox();document.querySelectorAll('.modal-overlay').forEach(m=>m.classList.remove('open'));}
  if(document.getElementById('lightbox').classList.contains('open')){
    if(e.key==='ArrowLeft')prevPhoto();if(e.key==='ArrowRight')nextPhoto();
  }
  if(document.getElementById('passwordView').classList.contains('active')&&e.key==='Escape')goBackToMembers();
});

// Offline
window.addEventListener('online',()=>document.getElementById('offlineBadge').style.display='none');
window.addEventListener('offline',()=>document.getElementById('offlineBadge').style.display='block');
if(!navigator.onLine)document.getElementById('offlineBadge').style.display='block';

// Service Worker
if('serviceWorker' in navigator)window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(()=>{}));

// START
init();
</script>
</body>
</html>
